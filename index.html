<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Helper for Jackie</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState } = React;
        const { render } = ReactDOM;

        const teamIds = {
            'steelers': '23', 'chiefs': '12', 'cowboys': '6', 'raiders': '13',
            'jets': '20', 'bills': '2', 'patriots': '17', 'dolphins': '15',
            'ravens': '33', 'bengals': '4', 'browns': '5', 'titans': '10',
            'colts': '11', 'jaguars': '30', 'texans': '34', 'broncos': '7',
            'chargers': '24', 'packers': '9', 'bears': '3', 'lions': '8',
            'vikings': '16', 'giants': '19', 'eagles': '21', 'commanders': '28',
            'cardinals': '22', 'rams': '14', 'seahawks': '26', '49ers': '25',
            'saints': '18', 'falcons': '1', 'panthers': '29', 'bucs': '27'
        };

        function NFLHelper() {
            const [messages, setMessages] = useState([
                {
                    type: 'assistant',
                    content: 'Hi Jackie! üëã Ask me about current NFL players, team rosters, or football rules!'
                }
            ]);
            const [inputValue, setInputValue] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const quickQuestions = [
                "Who is the quarterback for the Chiefs?",
                "Who are the running backs for the Cowboys?", 
                "What's a touchdown worth?",
                "How long is a football game?"
            ];

            const findTeam = (question) => {
                const lower = question.toLowerCase();
                for (const [name, id] of Object.entries(teamIds)) {
                    if (lower.includes(name)) return { name, id };
                }
                return null;
            };

            const fetchPlayerInfo = async (question) => {
                const team = findTeam(question);
                if (!team) return "Please specify which team you're asking about!";

                try {
                    // Use the correct ESPN API endpoint from the documentation
                    const url = `https://sports.core.api.espn.com/v2/sports/football/leagues/nfl/seasons/2024/teams/${team.id}/athletes?limit=200`;
                    const response = await fetch(url);
                    const data = await response.json();

                    if (!data.items || data.items.length === 0) {
                        return "I couldn't find roster information for that team right now.";
                    }

                    const lower = question.toLowerCase();
                    let targetPos = '';
                    
                    if (lower.includes('quarterback') || lower.includes('qb')) targetPos = 'QB';
                    else if (lower.includes('running back') || lower.includes('rb')) targetPos = 'RB';
                    else if (lower.includes('wide receiver') || lower.includes('wr')) targetPos = 'WR';

                    // Fetch detailed info for each athlete to get position data
                    const playersWithPositions = [];
                    
                    for (const item of data.items.slice(0, 20)) { // Limit to first 20 for performance
                        try {
                            const playerResponse = await fetch(item.$ref);
                            const playerData = await playerResponse.json();
                            
                            if (playerData.position && playerData.position.abbreviation === targetPos) {
                                playersWithPositions.push({
                                    name: playerData.displayName || playerData.name,
                                    jersey: playerData.jersey || '?',
                                    position: playerData.position.abbreviation
                                });
                            }
                        } catch (playerError) {
                            console.log('Player fetch error:', playerError);
                        }
                    }

                    if (playersWithPositions.length > 0) {
                        const teamName = team.name.charAt(0).toUpperCase() + team.name.slice(1);
                        
                        if (targetPos === 'QB') {
                            const qb = playersWithPositions[0];
                            return `${qb.name} is the quarterback for the ${teamName}. He wears #${qb.jersey}.`;
                        } else {
                            const playerList = playersWithPositions.slice(0, 3).map(p => 
                                `${p.name} (#${p.jersey})`
                            ).join(', ');
                            return `The ${teamName} ${targetPos}s include: ${playerList}.`;
                        }
                    } else {
                        return `I found the team roster but couldn't locate specific ${targetPos} position players. The ESPN API might be restructuring this data.`;
                    }

                } catch (error) {
                    console.error('API Error:', error);
                    return "I'm having trouble connecting to the NFL database right now. You can check current rosters at ESPN.com!";
                }
            };

            const getBasicAnswer = (question) => {
                const lower = question.toLowerCase();
                
                if (lower.includes('touchdown')) return "A touchdown is worth 6 points and happens when a team gets the ball into the opponent's end zone.";
                if (lower.includes('field goal')) return "A field goal is worth 3 points when the team kicks the ball through the goalposts.";
                if (lower.includes('first down')) return "A first down means a team gets 4 new attempts to advance the ball 10 yards.";
                if (lower.includes('long') && lower.includes('game')) return "A football game has 4 quarters, each 15 minutes long (60 minutes total game time).";
                if (lower.includes('players') && lower.includes('field')) return "Each team has 11 players on the field at any time.";
                
                return "Great question! Ask me about current NFL players, team rosters, or football rules. I'm here to help!";
            };

            const handleQuestion = async (question) => {
                const lower = question.toLowerCase();
                
                // Check if asking about current players
                if ((lower.includes('who is') || lower.includes('who are')) && 
                    (lower.includes('quarterback') || lower.includes('qb') || 
                     lower.includes('running back') || lower.includes('rb') ||
                     lower.includes('wide receiver') || lower.includes('wr'))) {
                    return await fetchPlayerInfo(question);
                }
                
                return getBasicAnswer(question);
            };

            const submitQuestion = async (question) => {
                if (!question.trim() || isLoading) return;
                
                setMessages(prev => [...prev, { type: 'user', content: question }]);
                setIsLoading(true);
                
                try {
                    const answer = await handleQuestion(question);
                    setMessages(prev => [...prev, { type: 'assistant', content: answer }]);
                } catch (error) {
                    setMessages(prev => [...prev, { 
                        type: 'assistant', 
                        content: "I'm having trouble right now, but I'm here to help with your football questions!" 
                    }]);
                }
                
                setIsLoading(false);
                setInputValue('');
            };

            return React.createElement('div', { 
                className: 'min-h-screen bg-gradient-to-br from-blue-50 to-purple-50' 
            },
                React.createElement('div', { 
                    className: 'bg-gradient-to-r from-blue-600 to-purple-600 text-white p-8 text-center' 
                },
                    React.createElement('div', { 
                        className: 'flex items-center justify-center gap-4 mb-4' 
                    },
                        React.createElement('div', { 
                            className: 'text-4xl' 
                        }, 'üèà'),
                        React.createElement('h1', { 
                            className: 'text-4xl font-bold' 
                        }, 'NFL Helper for Jackie'),
                        React.createElement('div', { 
                            className: 'text-3xl' 
                        }, '‚ù§Ô∏è')
                    ),
                    React.createElement('p', { 
                        className: 'text-xl opacity-90' 
                    }, 'Your personal guide to understanding football!')
                ),

                React.createElement('div', { 
                    className: 'max-w-4xl mx-auto p-6' 
                },
                    React.createElement('div', { 
                        className: 'bg-white rounded-2xl shadow-lg p-6 mb-6' 
                    },
                        React.createElement('h2', { 
                            className: 'text-xl font-bold mb-4' 
                        }, 'Try asking me:'),
                        React.createElement('div', { 
                            className: 'grid grid-cols-1 md:grid-cols-2 gap-3' 
                        },
                            ...quickQuestions.map((q, i) => 
                                React.createElement('button', {
                                    key: i,
                                    onClick: () => submitQuestion(q),
                                    className: 'p-3 bg-blue-50 hover:bg-blue-100 rounded-lg text-left border border-blue-200 transition-colors'
                                }, q)
                            )
                        )
                    ),

                    React.createElement('div', { 
                        className: 'bg-white rounded-2xl shadow-lg p-6 mb-6' 
                    },
                        React.createElement('div', { 
                            className: 'space-y-4 mb-6 max-h-96 overflow-y-auto' 
                        },
                            ...messages.map((msg, i) => 
                                React.createElement('div', { 
                                    key: i,
                                    className: `flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}` 
                                },
                                    React.createElement('div', { 
                                        className: `max-w-md p-4 rounded-lg ${
                                            msg.type === 'user' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'bg-gray-100 text-gray-800'
                                        }` 
                                    },
                                        msg.type === 'assistant' && React.createElement('div', { 
                                            className: 'text-xs text-blue-600 mb-1 font-semibold' 
                                        }, 'NFL Helper'),
                                        React.createElement('p', null, msg.content)
                                    )
                                )
                            )
                        ),

                        React.createElement('div', { 
                            className: 'flex gap-3' 
                        },
                            React.createElement('input', {
                                type: 'text',
                                value: inputValue,
                                onChange: (e) => setInputValue(e.target.value),
                                onKeyPress: (e) => e.key === 'Enter' && submitQuestion(inputValue),
                                placeholder: 'Ask about NFL players, teams, or rules...',
                                disabled: isLoading,
                                className: 'flex-1 p-3 border rounded-lg focus:outline-none focus:border-blue-500'
                            }),
                            React.createElement('button', {
                                onClick: () => submitQuestion(inputValue),
                                disabled: isLoading || !inputValue.trim(),
                                className: 'px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50'
                            }, isLoading ? 'Thinking...' : 'Ask')
                        )
                    ),

                    React.createElement('div', { 
                        className: 'text-center text-gray-500' 
                    }, 'v19 Made with ‚ù§Ô∏è to help Jackie enjoy football with the family')
                )
            );
        }

        render(React.createElement(NFLHelper), document.getElementById('root'));
    </script>
</body>
</html>
